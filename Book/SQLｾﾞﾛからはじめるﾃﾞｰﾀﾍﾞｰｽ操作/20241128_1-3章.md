## 目的

<!-- 目的(〜を知りたい/〜を実装したい) -->

- SQL の基本操作を学ぶ
- DB から必要な情報を取得する基本は 1-3 章で学んだので復習がてら整理

## 成果

<!-- 成果(できたこと/できなかったこと) -->

- [x] SELECT 文の基本的な実行順序と記述順序
- [x] データの検索方法

#### 所要時間

- 330m

#### 使用資料

<!-- 使用資料(教材/書籍/ワークシート/Youtube) -->
- SQLゼロから始めるデータベース操作（1−3章）

## 詳細

<!-- 詳細(キーワード/プロセス//具体例を挙げる/今回の課題解決を今後に繋げられる形で記録) -->

- SELECT 文の実行順序（DBMS ごとに細かい部分は異なる）
  ```SQL
  FROM -> WHERE -> GROUP BY -> HAVING -> SELECT -> ORDER BY
  ```
- 記述順序
  ```SQL
  SELECT coffee_name, tea_name, COUNT(*) AS tea_count
    FROM Cafe
   WHERE coffee_name = 'latte'
   GROUP BY coffee_name, tea_name
  HAVING tea_name = 'chamomile';
  ```
- カラムを編集する方法(AS)
  - 基本的には　`AS '(任意の名前)'`でカラム名を編集できる
  - 既存のカラム名を変更する場合：`cat_name AS dog_name`
  - 新規でカラムを追加する場合：`"動物" AS 'type'`
    - 注意：日本語のカラム名をつける場合は'ではなく"で囲うこと
- 重複を省く方法(DISTINCT)
  - SELECT 文で使用する
    ```SQL
    SELECT DISTINCT caffee_name
               FROM Cafe
    ```
  - SELECT 文で集約関数と併せて使う
    ```SQL
    SELECT DISTINCT SUM(caffee_price) AS "全てのコーヒーメニューの合計", SUM(DISTINCT caffee_price) AS "価格が同じメニューは削除された合計"
               FROM Cafe
    ```
  - 注意：NULL も 2 個 →1 個となる（1 つは残る）
- 条件を指定してフィルタをかける（WHERE 句）
  - WHERE は記述順では FROM の直後に置き、実行順では FROM の次に行われる検索 DB の絞り込み操作
  - 注意：集約関数は使えないので、HAVING と使い分けることが多い
    - 処理速度でみたら、先に DB にフィルタをかける WHERE は優勢。
    - 集約関数でも個々の行に対する処理なら WHERE,HAVING どちらでも良いことが多いので"WHERE"が使われやすい
    - 集約関数でも SUM や AVG などを使用し、データ複数を１まとめにしたグルーに対する処理は"HAVING"が使われるイメージ
- NULL を含む処理
  - SQL は３理論理であり、NULL を偽とせず不明(UNKNOWN)とするのが大きな特徴
  - ```5+NULLやNULL/9```などをしても相手がNULLなら答えは全てNULLとなる
  - 集約関数は基本的にNULLを除外して処理する
    - 注意：COUNT関数だけは```COUNT(*)```とすることで例外的にNULLを除外せずに数を数える
  - 検索結果からNULLを削除したいときは```(カラム名) IS NOT NULL```とする
- テーブルをグループ分けする(GROUP BY句)
  - NULLも1つのグループに分類される
  - フィルタをかけるのとは違い、テーブルに線を引いて切り分けるイメージ
- 検索結果の並び替え（ORDER BY句）
  - 基本的に、ランダムで並ぶ
  - ORDER BY句にカラム名を指定することでそのカラムはデフォルトの"昇順(ASC:アスク)"となる
  - 降順を指定したい場合はDESK：デスクを指定すれば良い
  - 各カラムごとにASCとDESKを変えることも可能
  - 注意：優先順を考えて書くこと！カラムを書く順番で表示が変わる
  ```SQL
  ORDER BY coffee_price SESC, coffee_name
  ```
  - 価格は降順（高い順）に並び、同価格のものがあれば昇順（50音順）に並ぶ
  ```SQL
  ORDER BY coffee_name, coffee_price SESC
  ```
  - カラムの順番を逆にすると、商品名が昇順（50音順）に並び、同じ名前のメニューがあれば価格が降順（高い順）に並ぶ

## 考察

<!-- 考察(今後の展望/) -->
- 輪読会のおかげで掘れている箇所を中心にまとめてみた
- 実際に動かしてわかることが多いので、DBがいじれるのありがたい...!!
- ３値論理が結構インパクト大きくて、NULLはNULLのまま置いておくというのがデータ量が莫大なSQLならではだな...と思った！
- mysqlやposgreでも少しずつ仕様が異なることがあるようなので、SQLでしっかり原理抑えておくのは大切そう
- これあれば、Excel不要だよな〜！上手く使いこなせるようになりたいゾ・・・