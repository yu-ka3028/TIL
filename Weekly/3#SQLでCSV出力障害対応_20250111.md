## 目的

<!-- 目的(〜を知りたい/〜を実装したい) -->

問題解決力向上を意識したい

- 仮説に誤りはないか
- そもそも何を解決したいのか、道筋を立ててから動く
- 紙に書く

## 成果

<!-- 成果(できたこと/できなかったこと) -->

- [x] GitHub の issue から実装
- [x] 該当コードの箇所特定
- [x] SQL で DB の値を取得

#### 所要時間

- 180m

#### 使用資料

<!-- 使用資料(教材/書籍/ワークシート/Youtube) -->

- [GitHub の issue](https://github.com/EC-CUBE/ec-cube/issues/5202)
- [SQL:join](https://zenn.dev/suzuki_hoge/articles/2022-12-table-join-1f145b243166f9)

## 詳細

<!-- 詳細(キーワード/プロセス//具体例を挙げる/今回の課題解決を今後に繋げられる形で記録) -->

### 解決したいこと

- CSV で出力時に一部データ（毎回異なる）が出力されない問題
  - 管理画面で表示されている全データ数 A(uniq な id)
  - CSV 出力されたデータ数 B（uniq な id A と一致すれば重複 OK）

### 考えたこと

- データ容量が大きく全件が表示できていない
- 当日出力の欠損データ内容は一致しているため、欠損データが異なるのは日付でなくキャッシュで SQL の内部処理が共通している可能性
- ページネーション（50 件/ページ）で意図しない動きをする
- product_id が降順に並んでおらず、desc の設定が data_update で意図しない動きがある → GitHub にて類似エラー共有頂いた

### やってみたこと（ほぼ時間の浪費）

- 出力した CSV ファイルを Cassava と Excel で開き全件数・重複を除く処理
  - cassava で開く理由は、[Excel より軽い・文字化けしにくい](https://scrapbox.io/2025-yuka3028/cassava%E3%81%AF%E4%BD%95%E3%81%8C%E4%BE%BF%E5%88%A9%EF%BC%9F)

### 学んだこと

- GitHub > file changed で差分を実装してみる方法（解決プルリクが上がっていたため）
- CSV 出力時する際のボタンにカーソルを当て URL を表示させ、それを grep で検索する
  `（やり方詳細追記予定）`
  `grep -r (URLからファイル名) ./*`
- DB の値検索方法（innner join, count）
  ```sql
  select *
  from A(管理画面の全件出力総数を表すproduct_id)
  JOIN B(CSVのorder_id) on A.product_id = B.order_id;
  ```
  - 下記 2 つのテーブルを join して分析
    - 管理画面の表示総数 A（count,innner join を使用し、product_id(uniq)が含まれるデータを重複 OK で出力）
    - CSV で出力された総数 B（Cassava の行数で確認）

### ハマったこと...

- 全体像の理解不足
  - CSV 出力側の重複可能性がある id(B) と、管理画面に表示される uniq な id(A) が別である認識がなかった
    - 管理画面に表示されるデータ数 A は uniq な値
    - CSV 出力される行数は id(A)の重複を含むため、管理画面 ＜ CSV 出力となる

### 次回のために...

- mysql で`desc (name);`して primary key や NULL が OK なカラムかを確認することで認識の齟齬を防げたのでは...!!
- まず紙に書いてみる
- 前提条件を見誤ったらその先の作業は全て無駄になるので現在地の把握が大切

## 考察

<!-- 考察(今後の展望/) -->
